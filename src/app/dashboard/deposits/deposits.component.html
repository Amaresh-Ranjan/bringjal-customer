@if(loaderEnable){
<app-custom-loader></app-custom-loader>
} @else {
@if(userData.status.subscribed===false){
<div class="header sticky top-0 z-50">
  <h1 class="heading_1 text-center text-cyan-800">Place Order</h1>
</div>
<div class="min-h-screen flex items-center justify-center p-3 md:p-5">
  <div class="w-full max-w-screen-2xl">
    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-cyan-100">
      <!-- Card Header -->
      <div class="bg-gradient-to-r from-cyan-500 to-cyan-600 p-2 md:p-6 text-center text-white">
        <h2 class="text-2xl font-semibold">Subscription Required</h2>
      </div>

      <!-- Card Body -->
      <div class="p-2 md:p-6 capitalize">
        <div class="bg-cyan-50 rounded-xl p-2 md:p-6 border border-cyan-100">
          <div class="text-center">
            <h2 class="text-xl font-semibold text-cyan-800 mb-4">
              In order to subscribe to a package, please first place an
              installation order
            </h2>
            <p class="text-cyan-700">
              Click the button below to get started with your subscription
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="w-full text-center mt-5">
      <button (click)="goToProductSelectionPage()" type="button" class="button">
        <div class="button-top">Subscribe Package</div>
        <div class="button-bottom"></div>
        <div class="button-base"></div>
      </button>
    </div>
  </div>
</div>
}@else {
<div class="header sticky top-0 z-50">
  <h1 class="heading_1 text-center text-cyan-800">Brinjal Deposits</h1>
</div>
<div class="min-h-screen flex items-center justify-center px-4 md:px-6">
  <div class="w-full max-w-screen-2xl">
    <!-- Main Card -->
    <div
      class="bg-white rounded-2xl shadow-lg overflow-hidden border border-cyan-100 mb-4"
    >
      <!-- Card Header -->
      <div
        class="bg-gradient-to-r from-cyan-500 to-cyan-600 p-4 md:p-6 text-center text-white"
      >
        <h2 class="text-xl md:text-2xl font-semibold">Your Deposits</h2>
      </div>

      <!-- Card Body -->
      <div class="p-4 md:p-6">
        <!-- Total Amount -->
        <div class="mb-6">
          <div class="flex items-start">
            <div>
              <h3 class="text-lg font-medium text-cyan-800 mb-2">
                Your Total Deposit Amount With Us
              </h3>
              <p class="text-2xl font-bold text-cyan-700">
                &#8377;{{
                  (deposit.device_deposit_amount || 0) +
                    (deposit.watercan_deposit_amount || 0) -
                    (deposit.membership_device_discount || 0) -
                    (deposit.membership_watercan_discount || 0) +
                    (deposit.membership_deposit || 0)
                }}
              </p>
            </div>
          </div>
        </div>

        <!-- Deposit Details -->
        <div
          class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white/50 p-4 rounded-lg border border-cyan-100"
        >
          <!-- DropPy Devices -->
          <div class="flex items-start">
            <div>
              <h3 class="text-lg font-medium text-cyan-800 mb-2">
                DropPy Devices
              </h3>
              <p class="text-lg font-semibold text-cyan-800">
                {{
                  (deposit?.device_quantity || 0) +
                    (deposit?.mem_device_qty_deposit || 0)
                }}
                x
                <span class="text-sm font-normal text-gray-500">{{
                  deposit?.device_quantity + deposit?.mem_device_qty_deposit ===
                  1
                    ? "unit"
                    : "units"
                }}</span>
              </p>
            </div>
          </div>

          <!-- Water Can Containers -->
          <div class="flex items-start">
            <div>
              <h3 class="text-lg font-medium text-cyan-800 mb-2">
                Water Can Containers
              </h3>
              <p class="text-lg font-semibold text-cyan-800">
                {{
                  (deposit?.watercan_quantity || 0) +
                    (deposit?.mem_can_qty_deposit || 0)
                }}
                x
                <span class="text-sm font-normal text-gray-500">units</span>
              </p>
            </div>
          </div>
          <!-- Pending Cans -->
          <div class="flex items-start">
            <div>
              <h3 class="text-lg font-medium text-cyan-800 mb-2">
                Pending Cans
              </h3>
              <p class="text-lg font-semibold text-cyan-800">
                {{ userData?.cans_in_posession }}
                x
                <span class="text-sm font-normal text-gray-500">
                  {{ userData?.cans_in_posession === 1 ? "unit" : "units" }}
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="w-full mt-4">
      <!-- Segment Toggle -->
      <div
        class="flex justify-center flex-wrap md:gap-6 gap-2 border-b border-cyan-500 p-2"
      >
        <button
          class="py-2 px-4 text-white font-semibold rounded-md transition-all"
          [ngClass]="{
            'bg-cyan-500': activeSegment === 'depositTransactionsHistory',
            'bg-cyan-300': activeSegment !== 'depositTransactionsHistory'
          }"
          (click)="setActiveSegment('depositTransactionsHistory')"
        >
          Transactions History
        </button>
        <button
          class="py-2 px-4 text-white font-semibold rounded-md transition-all"
          [ngClass]="{
            'bg-cyan-500': activeSegment === 'previousPendingCans',
            'bg-cyan-300': activeSegment !== 'previousPendingCans'
          }"
          (click)="setActiveSegment('previousPendingCans')"
        >
          Previous Pending Cans
        </button>
      </div>
      <!-- Content Display -->
      <div class="mt-4">
        <div
          *ngIf="activeSegment === 'depositTransactionsHistory'"
          class="p-4 bg-cyan-50 rounded-md"
        >
          <!-- Transaction History -->
          @if (previousTransactions.length > 0) {
          <div class="mt-8 mb-4">
            <div class="w-full text-center text-cyan-800 mb-4">
              <h2 class="heading_2 capitalize">Transaction History</h2>
            </div>
            <div class="grid grid-cols-1 gap-6 max-w-screen-2xl mx-auto">
              @for (order of previousTransactions; track $index) {
              <div
                class="bg-white rounded-2xl shadow-lg overflow-hidden border border-cyan-100 transition-all duration-300 hover:shadow-xl"
              >
                <!-- Card Header -->
                <div
                  class="bg-gradient-to-r from-cyan-50 to-blue-50 px-6 py-4 border-b border-cyan-100"
                >
                  <div class="flex flex-col capitalize">
                    <div class="flex items-center justify-between space-x-2">
                      <span class="text-sm font-medium text-cyan-700">
                        <i class="fas fa-calendar-alt mr-1"></i>
                        {{ order?.transaction_date | relativedate }}
                      </span>
                      <!-- @if (order.returnDeposit) {
                            <span
                              class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"
                            >
                              <i class="fas fa-undo mr-1"></i> Refunded
                            </span>
                            } @else {
                            <span
                              class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                            >
                              <i class="fas fa-wallet mr-1"></i> Deposit
                            </span>
                            } -->
                    </div>
                    <p class="text-sm text-gray-500 mt-2 md:mt-0">
                      {{ order?.description }}
                    </p>
                  </div>
                </div>

                <!-- Transaction Details -->
                <div class="p-6">
                  @if (!order.returnDeposit) {
                  <!-- Deposit Details -->
                  <div class="space-y-4">
                    @if (order?.watercan_quantity > 0 ||
                    order?.mem_can_qty_deposit > 0) {
                    <div
                      class="flex justify-between items-center py-2 border-b border-gray-100"
                    >
                      <span class="text-gray-600">Water Can Containers</span>
                      <span class="font-medium text-cyan-700">
                        {{
                          order?.watercan_quantity + order?.mem_can_qty_deposit
                        }}
                        x
                        {{
                          order?.watercan_quantity +
                            order?.mem_can_qty_deposit ===
                          1
                            ? "unit"
                            : "units"
                        }}
                      </span>
                    </div>
                    <div
                      class="flex justify-between items-center py-2 border-b border-gray-100"
                    >
                      @if (order?.watercan_deposit_amount) {
                      <span class="text-gray-600">Water Can Deposit</span>
                      <span class="text-cyan-700 font-bold"
                        >&#8377;{{ order?.watercan_deposit_amount }}</span
                      >
                      }
                    </div>
                    } @if (order?.device_deposit_amount) {
                    <div
                      class="flex justify-between items-center py-2 border-b border-gray-100"
                    >
                      <span class="text-gray-600">Device Deposit</span>
                      <span class="text-cyan-700 font-bold"
                        >&#8377;{{ order?.device_deposit_amount }}</span
                      >
                    </div>
                    } @if (order?.membership_deposit) {
                    <div
                      class="flex justify-between items-center py-2 border-b border-gray-100"
                    >
                      <span class="text-gray-600">Membership Deposit</span>
                      <span class="font-medium text-cyan-700"
                        >&#8377;{{ order?.membership_deposit }}</span
                      >
                    </div>
                    }
                  </div>
                  } @else {
                  <!-- Return Details -->
                  <div class="space-y-4">
                    <div
                      class="flex justify-between items-center py-2 border-b border-gray-100"
                    >
                      <span class="text-gray-600">Amount Returned</span>
                      <span class="font-medium text-green-600"
                        >&#8377;{{ order?.amountReturned }}</span
                      >
                    </div>

                    @if (order?.cans_returned_qty) {
                    <div
                      class="flex justify-between items-center py-2 border-b border-gray-100"
                    >
                      <span class="text-gray-600">Water Cans Returned</span>
                      <span class="font-medium text-green-600"
                        >{{ order?.cans_returned_qty }} x</span
                      >
                    </div>
                    } @if (order?.device_returned_qty) {
                    <div class="flex justify-between items-center py-2">
                      <span class="text-gray-600">Devices Returned</span>
                      <span class="font-medium text-green-600"
                        >{{ order?.device_returned_qty }} x</span
                      >
                    </div>
                    }
                  </div>
                  }
                </div>
              </div>
              }
            </div>
          </div>
          }@else{
          <div class="mt-8 mb-4">
            <div class="w-full text-center text-cyan-800 mb-4">
              <h2 class="heading_2 capitalize">No Transaction History</h2>
            </div>
          </div>
          }
        </div>
        <div
          *ngIf="activeSegment === 'previousPendingCans'"
          class="p-4 bg-cyan-50 rounded-md"
        >
          <!-- Pending Cans -->
          @if (userData?.cans_in_posession>0) {
          <div class="mt-8 mb-4">
            <div class="w-full text-center text-cyan-800 mb-4">
              <h2 class="heading_2 capitalize">Previous Pending Cans</h2>
            </div>
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-2"
            >
              @for (pending of userData?.cans_in_posession_details; track
              $index) {
              <div
                class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-shadow duration-300"
              >
                <div class="p-6">
                  <div class="flex items-center justify-between mb-4">
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-cyan-100 text-cyan-800"
                    >
                      <svg
                        class="w-4 h-4 mr-1.5"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                          clip-rule="evenodd"
                        ></path>
                      </svg>
                      Pending Cans
                    </span>
                    <span class="font-medium text-gray-600">{{
                      pending?.timestamp | date
                    }}</span>
                  </div>

                  <div class="space-y-3">
                    <div class="flex items-center justify-between">
                      <span class="text-gray-600">Quantity Due</span>
                      <span class="font-medium text-gray-900">{{
                        pending?.quantity
                      }}</span>
                    </div>

                    <div class="flex items-center justify-between">
                      <span class="text-gray-600">Order ID</span>
                      <span
                        class="font-mono text-sm text-cyan-600 bg-cyan-50 px-2 py-1 rounded"
                        >{{ pending?.orderId }}</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }@else{
          <div class="mt-8 mb-4">
            <div class="w-full text-center text-cyan-800 mb-4">
              <h2 class="heading_2 capitalize">No Pending Cans</h2>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
}
} @defer() {
<app-footer-section></app-footer-section>
}
