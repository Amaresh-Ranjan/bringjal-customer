@if (loaderEnable()) {
<app-custom-loader></app-custom-loader>
} @else {

<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="header sticky top-0 z-50">
    <h1 class="text-center heading_1 text-cyan-800">Refer & Earn</h1>
  </div>

  <div class="max-w-screen-2xl mx-auto pb-8 px-4 sm:px-6 lg:px-8">
    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
      <!-- Gradient Header -->
      <div
        class="bg-gradient-to-r from-cyan-600 to-emerald-600 p-6 text-center"
      >
        <div
          class="w-24 h-24 mx-auto bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm"
        >
          <img
            src="./assets/icons/gift_logo.svg"
            alt="Gift Icon"
            class="w-16 h-16 object-contain"
          />
        </div>
        <h2 class="mt-4 heading_1 text-white">Invite Friends & Earn Rewards</h2>
        <p class="mt-2 heading_6 text-cyan-100">
          Share your code and both get â‚¹100 when they join!
        </p>
      </div>

      <!-- Referral Code Section -->
      <div class="p-6 md:p-8">
        <div
          class="bg-cyan-50 border-2 border-dashed border-cyan-200 rounded-xl p-6 text-center"
        >
          <span class="md:text-lg text-sm font-medium text-cyan-700"
            >Your Unique Referral Code</span
          >
          <div class="mt-2">
            <span
              class="text-2xl md:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-emerald-600"
            >
              {{ referralCode }}
            </span>
          </div>
          @if(copieText){
          <p class="mt-4 text-sm text-green-600">
            Copied to clipboard!
            <span class="font-bold text-cyan-600">{{ referralCode }}</span>
          </p>
          }
          <button
            class="mt-4 px-6 py-2 bg-cyan-100 hover:bg-cyan-200 text-cyan-800 font-medium rounded-full transition-colors duration-200"
            (click)="copyCode()"
          >
            Copy Code
          </button>
        </div>

        <!-- Share Options -->
        <div class="mt-2">
          <h3 class="text-center heading_6 text-gray-700 mb-2">Share via</h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
            <!-- WhatsApp -->
            <a
              [href]="whatsappString"
              target="_blank"
              class="flex items-center justify-center space-x-2 px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:-translate-y-0.5"
            >
              <i class="bi bi-whatsapp text-xl"></i>
              <span>WhatsApp</span>
            </a>

            <!-- Gmail -->
            <a
              [href]="emailString"
              target="_blank"
              class="flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-cyan-500 to-cyan-600 hover:from-cyan-600 hover:to-cyan-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:-translate-y-0.5"
            >
              <i class="bi bi-envelope text-xl"></i>
              <span>Email</span>
            </a>
          </div>
        </div>

        <!-- Info Box -->
        <div
          class="mt-4 bg-emerald-50 border-l-4 border-emerald-500 rounded-r-lg p-4"
        >
          <div class="flex">
            <div class="flex-shrink-0">
              <svg
                class="h-5 w-5 text-emerald-600"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h2a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-emerald-800 capitalize">
                Share your referral code and earn rewards when friends join!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
   @if (referralTransactions.length > 0) {
      <div class="px-4 sm:px-6 lg:px-8 mb-3">
        <h2 class="heading_2 text-cyan-500 text-center mb-10 relative pb-2">
          All Referrals
        </h2>

        <div class="space-y-6">
          @for (refData of referralTransactions; track $index) {
          <div
            class="bg-white rounded-xl shadow-md overflow-hidden border border-cyan-50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1"
            role="article"
          >
            <!-- refData Header -->
            <div
              class="bg-gradient-to-r from-cyan-50 to-cyan-100 px-6 py-4 border-b border-cyan-100"
            >
              <div
                class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3"
              >
                <div class="flex-1 min-w-0">
                  <h3 class="text-lg font-semibold text-cyan-800 truncate">
                    {{ refData.status_message }}
                  </h3>
                  <!-- <p class="text-sm text-cyan-600 mt-1">
                    <span class="inline-flex items-center">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4 mr-1"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        />
                      </svg>
                      {{ refData.created_at | relativedate }}
                    </span>
                  </p> -->
                </div>

                <!-- Status Badge -->
                <!-- @if (refData.status.closed) {
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200"
                >
                  <span class="w-2 h-2 rounded-full bg-green-500 mr-1.5"></span>
                  Resolved
                </span>
                } @else if (refData.status.assigned) {
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200"
                >
                  <span class="w-2 h-2 rounded-full bg-blue-500 mr-1.5"></span>
                  Assigned
                </span>
                } @else if (refData.status.inProgress) {
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-800 border border-amber-200"
                >
                  <span class="w-2 h-2 rounded-full bg-amber-500 mr-1.5"></span>
                  In Progress
                </span>
                } @else {
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800 border border-gray-200"
                >
                  <span class="w-2 h-2 rounded-full bg-gray-500 mr-1.5"></span>
                  Open
                </span>
                } -->
              </div>
            </div>

            <!-- refData Content -->
            <div class="p-6">
              <div class="prose prose-cyan max-w-none text-gray-600">
                <p><b>Receiver Name :</b> {{ refData?.receiver_name }}</p>
              </div>
              <div class="prose prose-cyan max-w-none text-gray-600">
                <p><b>Receiver Email :</b> {{ refData?.receiver_email }}</p>
              </div>
              <div class="prose prose-cyan max-w-none text-gray-600">
                <p><b>Receiver Phone :</b> {{ refData?.receiver_phone }}</p>
              </div>

              @if (refData.referral_footprints.length > 0) {
              <div class="mt-6 pt-5 border-t border-cyan-50">
                <h4
                  class="flex items-center text-sm font-medium text-cyan-800 mb-3"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 mr-2 text-cyan-500"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                    />
                  </svg>
                  Status
                </h4>
                <div class="space-y-3">
                  @for (footprints of refData.referral_footprints; track $index) {
                  <div class="bg-cyan-50 rounded-lg p-4 border border-cyan-100">
                    <p class="text-sm text-gray-700">{{ footprints.footprint_type }}</p>
                    <div class="mt-2 flex items-center text-xs text-cyan-600">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-3.5 w-3.5 mr-1"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                        />
                      </svg>
                      {{ footprints.timestamp | relativedate }}
                    </div>
                  </div>
                  }
                </div>
              </div>
              }
            </div>
          </div>
          }

          <!-- Show More Button -->
          @if (referralTransactions.length < totalCount) {
          <div class="flex justify-center mt-8 mb-4">
            <button
              (click)="getReferralTransaction()"
              class="group relative inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-cyan-500 to-cyan-600 text-white font-medium rounded-full shadow-md hover:shadow-lg hover:from-cyan-600 hover:to-cyan-700 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2"
              type="button"
            >
              <span>Show More Referrals</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 ml-2 transition-transform duration-300 group-hover:translate-x-1"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3"
                />
              </svg>
            </button>
          </div>
          }
        </div>
      </div>
      }
</div>
@defer() {
<app-footer-section></app-footer-section>
}
}